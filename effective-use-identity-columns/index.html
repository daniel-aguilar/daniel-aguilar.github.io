<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Effective Use of SQL Identity Columns (Oracle &amp; Postgres) | Daniel’s Blog</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Effective Use of SQL Identity Columns (Oracle &amp; Postgres)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The concept of SQL tables with an auto incremental column for its primary key it’s obviously not new, as it is easily implemented using sequences. Now, on December of 2003 the SQL:2003 standard introduced the identity column type, along with the syntax GENERATED AS IDENTITY, which is currently supported by virtually all RDBMS providers. Let’s take a quick look at how we can declare primary key columns with auto generated identifiers, without relying on vendor-specific syntax!" />
<meta property="og:description" content="The concept of SQL tables with an auto incremental column for its primary key it’s obviously not new, as it is easily implemented using sequences. Now, on December of 2003 the SQL:2003 standard introduced the identity column type, along with the syntax GENERATED AS IDENTITY, which is currently supported by virtually all RDBMS providers. Let’s take a quick look at how we can declare primary key columns with auto generated identifiers, without relying on vendor-specific syntax!" />
<meta property="og:site_name" content="Daniel’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-03-03T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Effective Use of SQL Identity Columns (Oracle &amp; Postgres)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-03-03T00:00:00+00:00","datePublished":"2024-03-03T00:00:00+00:00","description":"The concept of SQL tables with an auto incremental column for its primary key it’s obviously not new, as it is easily implemented using sequences. Now, on December of 2003 the SQL:2003 standard introduced the identity column type, along with the syntax GENERATED AS IDENTITY, which is currently supported by virtually all RDBMS providers. Let’s take a quick look at how we can declare primary key columns with auto generated identifiers, without relying on vendor-specific syntax!","headline":"Effective Use of SQL Identity Columns (Oracle &amp; Postgres)","mainEntityOfPage":{"@type":"WebPage","@id":"/effective-use-identity-columns/"},"url":"/effective-use-identity-columns/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Daniel&apos;s Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Daniel&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Effective Use of SQL Identity Columns (Oracle &amp; Postgres)</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-03-03T00:00:00+00:00" itemprop="datePublished">Mar 3, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>The concept of SQL tables with an auto incremental column for its
primary key it’s obviously not new, as it is easily implemented using
sequences. Now, on December of 2003 the <a href="https://www.iso.org/standard/34132.html">SQL:2003</a> standard
introduced the identity column type, along with the syntax <code class="language-plaintext highlighter-rouge">GENERATED
AS IDENTITY</code>, which is currently supported by virtually all <abbr title="Relational Database Management System">RDBMS</abbr>
providers. Let’s take a quick look at how we can declare primary key
columns with auto generated identifiers, without relying on
vendor-specific syntax!</p>

<h2 id="plain-sequences">Plain Sequences</h2>

<p>This is the most straightforward way to produce primary key
values. Sequences generate unique integers and can be incremented by
an arbitrary number like 1, 20, -1, etc. Consider the following table:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">student</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">INTEGER</span><span class="p">,</span>
  <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">pk_student</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span></code></pre></figure>

<p>We could then create a sequence to generate valid data for our <code class="language-plaintext highlighter-rouge">id</code>
primary key column:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="n">SEQUENCE</span> <span class="n">seq_student</span><span class="p">;</span>
<span class="cm">/* Postgres specific syntax (i.e. the nextval function).
Oracle's equivalent would be seq_student.NEXTVAL */</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">'seq_student'</span><span class="p">),</span> <span class="s1">'Victoria'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">'seq_student'</span><span class="p">),</span> <span class="s1">'Manuel'</span><span class="p">);</span></code></pre></figure>

<p>This approach works fine but assumes some sort of nomenclature is in
place—you know which sequence belongs to the <code class="language-plaintext highlighter-rouge">student</code> table due to
its name alone. Another developer might mistakenly use a different
sequence, an ad hoc value, or even drop the sequence entirely (no
errors will be thrown). Without any corresponding documentation there
really is no way to tell at a glance how <code class="language-plaintext highlighter-rouge">id</code> values are produced,
perhaps they’re managed in a different system altogether.</p>

<h2 id="attached-sequences">Attached Sequences</h2>

<p>Auto incremental primary key columns are so common that Postgres
offers a <a href="https://www.postgresql.org/docs/16/datatype-numeric.html#DATATYPE-SERIAL">shorthand</a>. We could redefine the <code class="language-plaintext highlighter-rouge">student</code> table like
so:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">student</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">SERIAL</span><span class="p">,</span> <span class="c1">--shorthand type to create unique identifier columns </span>
  <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">pk_student</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/* No need to explicitly define a sequence.
Later INSERT statements can omit the primary key column: */</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Victoria'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Manuel'</span><span class="p">);</span>

<span class="c1">--Deleting the table also removes the associated sequence:</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">student</span><span class="p">;</span></code></pre></figure>

<p>In contrast, Oracle offers no shorthands and requires the declaration
of a sequence beforehand, using the NEXTVAL function as the default
value for the column:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="n">SEQUENCE</span> <span class="n">seq_student</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">student</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="n">seq_student</span><span class="p">.</span><span class="n">NEXTVAL</span><span class="p">,</span>
  <span class="n">name</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">pk_student</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Victoria'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Manuel'</span><span class="p">);</span></code></pre></figure>

<p>These last two examples make the table <code class="language-plaintext highlighter-rouge">student</code> depend on a certain
sequence, which can’t be dropped on a whim. The table declaration
itself makes it very clear how the primary key values are generated,
and thus our intentions more evident.</p>

<p>Of course, other <abbr title="Relational Database Management System">RDBMS</abbr> vendors have their own unique ways of
generating unique values (see what I did there?), such as MySQL’s
<a href="https://dev.mysql.com/doc/refman/8.0/en/example-auto-increment.html">AUTO_INCREMENT attribute</a>, which also works in <a href="http://www.h2database.com/html/features.html?highlight=AUTO_INCREMENT&amp;search=AUTO_INCREMENT#firstFound">H2</a>:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">student</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">INT</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">pk_student</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Maria'</span><span class="p">);</span></code></pre></figure>

<p>It’s important to keep in mind that auto generated clauses <strong>do not
necessarily create the primary key constraint automatically</strong>.</p>

<h2 id="identity-columns">Identity Columns</h2>

<p>Identity columns are the ultimate way to declare auto generated
primary key columns, using good ol’ standard SQL (ISO/IEC 9075) and
nothing else. Here’s what the <code class="language-plaintext highlighter-rouge">student</code> table could be rewritten as,
using the identity clause:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">student</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">GENERATED</span> <span class="k">BY</span> <span class="k">DEFAULT</span> <span class="k">AS</span> <span class="k">IDENTITY</span><span class="p">,</span>
  <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">pk_student</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Paige'</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">student</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'Paige'</span><span class="p">;</span>
<span class="c1">--&gt; 1</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Robert'</span><span class="p">);</span>
<span class="c1">--&gt; Constraint violation error</span>

<span class="c1">--No dangling sequences either:</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">student</span><span class="p">;</span> <span class="c1">--purge (Oracle)</span></code></pre></figure>

<h3 id="customized-sequence-properties">Customized Sequence Properties</h3>

<p>Because identity columns have an implicit sequence attached to it,
they can be tailored similarly to the <code class="language-plaintext highlighter-rouge">CREATE SEQUENCE</code> statement:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">student</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">GENERATED</span> <span class="n">ALWAYS</span> <span class="k">AS</span> <span class="k">IDENTITY</span> <span class="p">(</span>
    <span class="k">START</span> <span class="k">WITH</span> <span class="mi">25</span> <span class="k">INCREMENT</span> <span class="k">BY</span> <span class="mi">25</span> <span class="c1">--Override default options</span>
  <span class="p">),</span>
  <span class="n">name</span> <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Ben'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Wendy'</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">student</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'Wendy'</span><span class="p">;</span>
<span class="c1">--&gt; 50</span></code></pre></figure>

<h3 id="always-or-by-default">ALWAYS or BY DEFAULT?</h3>

<p>The identity column clause has two different flavors: identifiers can
be generated <code class="language-plaintext highlighter-rouge">ALWAYS</code> or <code class="language-plaintext highlighter-rouge">BY DEFAULT</code>. The former instructs the
database to always generate a value, and will actually throw an error
if you do try to insert one yourself:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">test_error</span> <span class="p">(</span>
  <span class="n">id_col</span> <span class="nb">INTEGER</span> <span class="k">GENERATED</span> <span class="n">ALWAYS</span> <span class="k">AS</span> <span class="k">IDENTITY</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">test_error</span> <span class="p">(</span><span class="n">id_col</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="c1">--&gt; ORA-32795: cannot insert into a generated always identity column</span></code></pre></figure>

<p>Ultimately it all comes down to taste. Personally, I find the <code class="language-plaintext highlighter-rouge">BY
DEFAULT</code> behaviour a bit more forgiving (say you need to change an ID
for whatever reason).</p>

<h3 id="orm-support">ORM Support</h3>

<p>Object–relational mapping providers have great support for identity
columns out-of-the-box. In fact, it’s the default for primary key
properties in <a href="https://learn.microsoft.com/en-us/ef/core/modeling/generated-properties?tabs=data-annotations#primary-keys">Entity Framework Core</a>. Here’s how we could map the
<code class="language-plaintext highlighter-rouge">student</code> table to a JPA Entity, using <a href="https://jakarta.ee/specifications/persistence/3.2/apidocs/jakarta.persistence/jakarta/persistence/generationtype#IDENTITY">GenerationType.IDENTITY</a>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">org.danielaguilar.samples</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">jakarta.persistence.*</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Student</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
	
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	
	<span class="c1">// ...</span>
<span class="o">}</span></code></pre></figure>

<h2 id="conclusion">Conclusion</h2>

<p>Identity columns are a great and universal way to declare primary key
columns for our tables. Because it’s part of the SQL standard, this
particular syntax works with <em>almost</em> all the major <abbr title="Relational Database Management System">RDBMS</abbr> vendors,
hopefully decreasing the cognitive load necessary when working on
multiple systems.</p>


  </div><a class="u-url" href="/effective-use-identity-columns/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Daniel&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <p>There will be code</p>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/daniel-aguilar"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">daniel-aguilar</span></a></li><li><a href="https://www.linkedin.com/in/dan-aguilar"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">dan-aguilar</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>
          This work is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a><img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt="" style="max-width: 1em;max-height:1em;margin-left: .2em;"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt="" style="max-width: 1em;max-height:1em;margin-left: .2em;">
        </p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
